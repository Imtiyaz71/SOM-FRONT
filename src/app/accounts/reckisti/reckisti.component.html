<div class="container mt-4">

  <h4 class="mb-4 text-center text-primary fw-bold">ðŸ’° Receive Kisti Entry</h4>

  <!-- ===== FORM SECTION ===== -->
  <form (ngSubmit)="kistireceivesave()" #formRef="ngForm" class="card p-4 shadow-sm border-0 rounded-3 mb-4">

    <div class="row g-3">

      <!-- Kisti Type -->
      <div class="col-md-4">
        <label for="typeid" class="form-label fw-semibold">Kisti Type</label>
        <select
          id="typeid"
          class="form-select"
          [(ngModel)]="savereckisti.typeid"
          name="typeid"
          required
          (change)="onTypeChange(savereckisti.typeid)"
        >
          <option value="0">-- Select Type --</option>
          <option *ngFor="let t of ktype" [value]="t.id">{{ t.typeName }}</option>
        </select>
      </div>

      <!-- Member -->
      <div class="col-md-4">
        <label for="memNo" class="form-label fw-semibold">Member</label>
        <select
          id="memNo"
          class="form-select"
          [(ngModel)]="savereckisti.memNo"
          name="memNo"
          required
        >
          <option value="0">-- Select Member --</option>
          <option *ngFor="let t of mem" [value]="t.memNo">{{ t.givenName }}</option>
        </select>
      </div>

      <!-- Payable Amount -->
      <div class="col-md-4">
        <label for="paybleamount" class="form-label fw-semibold">Payable Amount</label>
        <input
          type="number"
          id="paybleamount"
          class="form-control"
          [(ngModel)]="savereckisti.paybleamount"
          name="paybleamount"
          readonly
        />
      </div>

      <!-- Received Amount -->
      <div class="col-md-4">
        <label for="recamount" class="form-label fw-semibold">Received Amount</label>
        <input
          type="number"
          id="recamount"
          class="form-control"
          [(ngModel)]="savereckisti.recamount"
          name="recamount"
          placeholder="Enter Received Amount"
          required
        />
      </div>

      <!-- Receive Date -->
      <div class="col-md-4">
        <label for="recdate" class="form-label fw-semibold">Receive Date</label>
        <input
          type="date"
          id="recdate"
          class="form-control"
          [(ngModel)]="savereckisti.recdate"
          name="recdate"
          required
        />
      </div>

      <!-- Month -->
      <div class="col-md-2">
        <label for="recmonth" class="form-label fw-semibold">Month</label>
        <select
          id="recmonth"
          class="form-select"
          [(ngModel)]="savereckisti.recmonth"
          name="recmonth"
          required
        >
          <option *ngFor="let m of months" [value]="m">{{ m }}</option>
        </select>
      </div>

      <!-- Year -->
      <div class="col-md-2">
        <label for="recyear" class="form-label fw-semibold">Year</label>
        <select
          id="recyear"
          class="form-select"
          [(ngModel)]="savereckisti.recyear"
          name="recyear"
          required
        >
          <option *ngFor="let y of years" [value]="y">{{ y }}</option>
        </select>
      </div>

      <!-- Remark -->
      <div class="col-12">
        <label for="remark" class="form-label fw-semibold">Remarks</label>
        <textarea
          id="remark"
          class="form-control"
          rows="2"
          [(ngModel)]="savereckisti.remark"
          name="remark"
          placeholder="Enter remarks (optional)"
        ></textarea>
      </div>
    </div>

    <div class="mt-4 text-end">
      <button type="submit" class="btn btn-success px-5">
        ðŸ’¾ Save Record
      </button>
    </div>
  </form>

  <!-- ===== SEARCH + GRID SECTION ===== -->
  <div class="card shadow-sm border-0">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <span>ðŸ“‹ Kisti Received List</span>
      <input
        type="text"
        class="form-control w-25"
        placeholder="ðŸ” Search by Member No"
        [(ngModel)]="searchMemNo"
        name="searchMemNo"
      />
    </div>

    <div class="card-body p-0">
      <table class="table table-striped table-bordered m-0">
        <thead class="table-light text-center align-middle">
          <tr>
            <th>#</th>
            <th>Member No</th>
            <th>Member Name</th>
            <th>Type</th>
            <th>Month</th>
            <th>Year</th>
            <th>Payable</th>
            <th>Received</th>
            <th>Due</th>
            <th>Date</th>
            <th>Month</th>
            <th>Remark</th>
          </tr>
        </thead>
        <tbody>
        <tr *ngFor="let item of filteredRec | paginate: { itemsPerPage: itemsPerPage, currentPage: page }; let i = index">
            <td>{{ (page - 1) * itemsPerPage + i + 1 }}</td>
            <td>{{ item.memNo }}</td>
            <td>{{ item.givenName }}</td>
            <td>{{ item.typeName }}</td>
            <td>{{ item.recMonth }}</td>
            <td>{{ item.recYear }}</td>
            <td>{{ item.paybleAmount }}</td>
            <td>{{ item.recAmount }}</td>
            <td>{{ item.due }}</td>
            <td>{{ item.recDate | date: 'dd-MMM-yyyy' }}</td>
            <td>{{ item.recMonth}}-{{item.recYear}}</td>
            <td>{{ item.remarks }}</td>
          </tr>

          <tr *ngIf="!rec || rec.length === 0">
            <td colspan="10" class="text-center text-muted py-3">
              No records found.
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card-footer text-center bg-light">
      <pagination-controls
        (pageChange)="page = $event"
        previousLabel="Prev"
        nextLabel="Next"
      ></pagination-controls>
    </div>
  </div>
</div>
