<div class="container-fluid mt-3">
  <div class="row">

    <!-- Left Column: Loan Paid Form -->
    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">Pay Loan</div>
        <div class="card-body">
          <form #loanForm="ngForm" (ngSubmit)="saveLoanPayment()">

            <!-- Select Loan -->
            <div class="mb-2">
              <label class="form-label">Select Loan</label>
              <select class="form-control" [(ngModel)]="selectedLoan" name="selectedLoan" required>
                <option *ngFor="let loan of loans" [ngValue]="loan">
                  {{loan.fullName}} - {{loan.phone}} - {{loan.typeName}}
                </option>
              </select>
            </div>

            <!-- Payable & Paid Amount -->
            <div class="mb-2">
              <label class="form-label">Payable Amount</label>
              <input type="number" class="form-control" [value]="selectedLoan?.monthlyPrinciplePayable" readonly>
            </div>
            <div class="mb-2">
              <label class="form-label">Paid Amount</label>
              <input type="number" class="form-control" [(ngModel)]="tempPaidAmount" name="paidAmount" required>
            </div>

            <!-- Principal & Interest -->
            <div class="mb-2">
              <label class="form-label">Principal</label>
              <input type="number" class="form-control" [value]="selectedLoan?.monthlyPrincipal" readonly>
            </div>
            <div class="mb-2">
              <label class="form-label">Interest</label>
              <input type="number" class="form-control" [value]="selectedLoan?.monthWiseInterest" readonly>
            </div>

            <!-- Month & Year -->
            <div class="mb-2">
              <label class="form-label">Month</label>
              <select class="form-control" [(ngModel)]="selectedMonth" name="month" required>
                <option *ngFor="let month of months">{{month}}</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Year</label>
              <select class="form-control" [(ngModel)]="selectedYear" name="year" required>
                <option *ngFor="let year of years">{{year}}</option>
              </select>
            </div>

            <!-- Paid By -->
            <div class="mb-2">
              <label class="form-label">Paid By</label>
              <input type="text" class="form-control" [(ngModel)]="paidBy" name="pBy" readonly>
            </div>

            <button type="submit" class="btn btn-success w-100 mt-2">Submit Payment</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Right Column: Loan Paid History Table -->
    <div class="col-md-9">
      <h2>Loan Paid History</h2>

      <div class="table-responsive" style="max-height:300px; overflow:auto;">
        <table class="table table-striped table-bordered table-hover table-sm">
          <thead class="table-dark text-center">
            <tr>
              <th>Name</th>
              <th>Phone</th>
              <th>Payable</th>
              <th>Paid Amount</th>
              <th>Principal</th>
              <th>Interest</th>
              <th>Month</th>
              <th>Year</th>
              <th>Payment Date</th>
            </tr>
          </thead>
          <tbody class="text-center">
            <tr *ngFor="let paid of displayedLoanPaid">
              <td>{{paid.fullName}}</td>
              <td>{{paid.phone}}</td>
              <td>{{paid.payble | number:'1.0-2'}}</td>
              <td>{{paid.paidAmount | number:'1.0-2'}}</td>
              <td>{{paid.principle | number:'1.0-2'}}</td>
              <td>{{paid.interest | number:'1.0-2'}}</td>
              <td>{{months[paid.pMonth - 1]}}</td>
              <td>{{paid.pYear}}</td>
              <td>{{paid.pDate | date:'dd-MM-yyyy HH:mm'}}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between mt-2 mb-4">
        <button class="btn btn-primary" (click)="prevPaidPage()" [disabled]="currentPaidPage === 1">Previous</button>
        <span>Page {{currentPaidPage}} of {{totalPaidPages}}</span>
        <button class="btn btn-primary" (click)="nextPaidPage()" [disabled]="currentPaidPage === totalPaidPages">Next</button>
      </div>

      <!-- Existing Loan Details Table -->
      <h2>Loan Details</h2>

      <div class="mb-3">
        <input type="text" class="form-control" placeholder="Search by phone" [(ngModel)]="searchPhone" (input)="onSearch()">
      </div>

      <div class="table-responsive" style="max-height:400px; overflow:auto;">
        <table class="table table-striped table-bordered table-hover table-sm">
          <thead class="table-dark text-center">
            <tr>
              <th>Name</th>
              <th>Phone</th>
              <th>Loan Type</th>
              <th>Principal</th>
              <th>Start Date</th>
              <th>End Contract</th>
              <th>Months Passed</th>
              <th>Active Month</th>
              <th>Paid Months</th>
              <th>Remaining Month</th>
              <th>Month-wise Interest</th>
              <th>Monthly Principal</th>
              <th>Monthly Payable</th>
              <th>Running Interest</th>
              <th>Delay Interest</th>
              <th>Total Payable</th>
            </tr>
          </thead>
          <tbody class="text-center">
            <tr *ngFor="let loan of displayedLoans">
              <td>{{ loan.fullName }}</td>
              <td>{{ loan.phone }}</td>
              <td>{{ loan.typeName }}</td>
              <td>{{ loan.principal | number:'1.0-2' }}</td>
              <td>{{ loan.sDate | date:'dd-MM-yyyy' }}</td>
              <td>{{ loan.endContractAt | date:'dd-MM-yyyy' }}</td>
              <td>{{ loan.monthsPassed }}</td>
              <td>{{ loan.activeMonthRunning }}</td>
              <td>{{ loan.paidMonths }}</td>
              <td>{{ loan.remainingMonth }}</td>
              <td>{{ loan.monthWiseInterest | number:'1.0-2' }}</td>
              <td>{{ loan.monthlyPrincipal | number:'1.0-2' }}</td>
              <td>{{ loan.monthlyPrinciplePayable | number:'1.0-2' }}</td>
              <td>{{ loan.runningInterestTotal | number:'1.0-2' }}</td>
              <td>{{ loan.calculatedDelayInterest | number:'1.0-2' }}</td>
              <td>{{ loan.totalPayable | number:'1.0-2' }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between mt-2">
        <button class="btn btn-primary" (click)="prevPage()" [disabled]="currentPage === 1">Previous</button>
        <span>Page {{currentPage}} of {{totalPages}}</span>
        <button class="btn btn-primary" (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
      </div>

    </div>

  </div>
</div>
