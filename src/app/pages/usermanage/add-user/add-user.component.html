<div class="card shadow mb-4">
  <div class="card-header py-3 d-flex justify-content-between align-items-center">
    <h6 class="m-0 font-weight-bold text-primary">User Info List</h6>
    <div class="d-flex">
      <input type="text" class="form-control form-control-lg mr-3"
             placeholder="Search by username..."
             [(ngModel)]="searchText"
             (input)="onSearchInput()" />

      <button *ngIf="role=='Admin'" class="btn btn-primary btn-lg" (click)="openAddUserModal()">Add User</button>
      <button *ngIf="role=='Admin'" class="btn btn-success btn-lg ml-2" (click)="openEducationModal()">Add Education</button>
      <button *ngIf="role=='Admin'" class="btn btn-warning btn-lg ml-2" (click)="openPhotoModal()">Upload Photo</button>
    </div>
  </div>

  <div class="card-body">

    <div class="table-responsive">
      <table class="table table-bordered table-striped" width="100%" cellspacing="0">
        <thead class="thead-dark">
          <tr>
            <th>Full Name</th>
            <th>Username</th>
            <th>Email</th>
            <th>Phone</th>
            <th>NID</th>
            <th>Address</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of filteredUsers">
            <td>{{ user.fullName }}</td>
            <td>{{ user.username }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.phone }}</td>
            <td>{{ user.niD }}</td>
            <td>{{ user.address }}</td>
          <td>
          <button class="btn btn-info btn-sm" (click)="openDetailsModal(user)">Details</button>
         <button *ngIf="role=='Admin'" class="btn btn-primary btn-sm ml-1" (click)="openEditUserModal(user)">Edit</button>
          <button *ngIf="role=='Admin'" class="btn btn-danger btn-sm ml-1" (click)="onDelete(user.username,username)">Delete</button>

        </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add User Modal -->
<div *ngIf="showAddUserModal" class="modal d-block" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New User</h5>
        <button type="button" class="close" (click)="closeAddUserModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form #addUserForm="ngForm">
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>Full Name</label>
              <input type="text" class="form-control form-control-lg" [(ngModel)]="newUser.fullName" name="fullName" required>
            </div>
            <div class="form-group col-md-6">
              <label>User Name</label>
              <input type="text" class="form-control form-control-lg" [(ngModel)]="newUser.username" name="username" required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>Email</label>
              <input type="email" class="form-control form-control-lg" [(ngModel)]="newUser.email" name="email">
            </div>
            <div class="form-group col-md-6">
              <label>Phone</label>
              <input type="text" class="form-control form-control-lg" [(ngModel)]="newUser.phone" name="phone">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>NID</label>
              <input type="text" class="form-control form-control-lg" [(ngModel)]="newUser.niD" name="niD">
            </div>
            <div class="form-group col-md-6">
              <label>Address</label>
              <input type="text" class="form-control form-control-lg" [(ngModel)]="newUser.address" name="address">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>Father</label>
              <input type="text" class="form-control form-control-lg" [(ngModel)]="newUser.father" name="father">
            </div>
            <div class="form-group col-md-6">
              <label>Mother</label>
              <input type="text" class="form-control form-control-lg" [(ngModel)]="newUser.mother" name="mother">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-lg" (click)="closeAddUserModal()">Close</button>
        <button type="button" class="btn btn-primary btn-lg" (click)="saveUser()">Save</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Education Modal -->
<div *ngIf="showAddEducationModal" class="modal d-block" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Education</h5>
        <button type="button" class="close" (click)="closeEducationModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form #addEducationForm="ngForm">
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>User</label>
              <select class="form-control form-control-lg" [(ngModel)]="newEducation.username" name="username" required>
                <option *ngFor="let user of users" [value]="user.username">{{ user.username }}</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>Degree</label>
              <input type="text" class="form-control form-control-lg" [(ngModel)]="newEducation.degree" name="degree" required>
            </div>
            <div class="form-group col-md-6">
              <label>Field of Study</label>
              <input type="text" class="form-control form-control-lg" [(ngModel)]="newEducation.fieldOfStudy" name="fieldOfStudy">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>School Name</label>
              <input type="text" class="form-control form-control-lg" [(ngModel)]="newEducation.schoolName" name="schoolName" required>
            </div>
            <div class="form-group col-md-6">
              <label>Start Date</label>
              <input type="date" class="form-control form-control-lg" [(ngModel)]="newEducation.startDate" name="startDate">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>End Date</label>
              <input type="date" class="form-control form-control-lg" [(ngModel)]="newEducation.endDate" name="endDate">
            </div>
            <div class="form-group col-md-6">
              <label>Description</label>
              <input type="text" class="form-control form-control-lg" [(ngModel)]="newEducation.description" name="description">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-lg" (click)="closeEducationModal()">Close</button>
        <button type="button" class="btn btn-primary btn-lg" (click)="saveEducation()">Save</button>
      </div>
    </div>
  </div>
</div>

<!-- Upload Photo Modal -->
<div *ngIf="showAddPhotoModal" class="modal d-block" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Upload Photo</h5>
        <button type="button" class="close" (click)="closePhotoModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form #addPhotoForm="ngForm">
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>User</label>
              <select class="form-control form-control-lg" [(ngModel)]="newPhoto.username" name="username" required>
                <option *ngFor="let user of users" [value]="user.username">{{ user.username }}</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>Photo</label>
              <input type="file" class="form-control form-control-lg" (change)="onPhotoSelected($event)" required>
            </div>
          </div>
          <div *ngIf="photoPreview" class="form-row mt-2">
            <div class="col-md-6">
              <img [src]="photoPreview" alt="Preview" class="img-thumbnail"/>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-lg" (click)="closePhotoModal()">Close</button>
        <button type="button" class="btn btn-primary btn-lg" (click)="savePhoto()">Upload</button>
      </div>
    </div>
  </div>
</div>

<!-- User Details Modal -->
<div *ngIf="showUserDetailsModal" class="modal d-block" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">User Details</h5>
        <button type="button" class="close" (click)="closeUserDetailsModal()">&times;</button>
      </div>
      <div class="modal-body" *ngIf="selectedUser">
        <p><strong>Full Name:</strong> {{ selectedUser.fullName }}</p>
        <p><strong>Username:</strong> {{ selectedUser.username }}</p>
        <p><strong>Email:</strong> {{ selectedUser.email }}</p>
        <p><strong>Phone:</strong> {{ selectedUser.phone }}</p>
        <p><strong>NID:</strong> {{ selectedUser.niD }}</p>
        <p><strong>Address:</strong> {{ selectedUser.address }}</p>
        <p><strong>Father:</strong> {{ selectedUser.father }}</p>
        <p><strong>Mother:</strong> {{ selectedUser.mother }}</p>
        <p><strong>Degree:</strong> {{ selectedUser.degree }}</p>
        <p><strong>Field of Study:</strong> {{ selectedUser.fieldOfStudy }}</p>
        <p><strong>School Name:</strong> {{ selectedUser.schoolName }}</p>
        <p><strong>Start Date:</strong> {{ selectedUser.startDate }}</p>
        <p><strong>End Date:</strong> {{ selectedUser.endDate }}</p>
        <p><strong>Description:</strong> {{ selectedUser.description }}</p>

        <div *ngIf="photoPreview">
          <img [src]="photoPreview" alt="User Photo" class="img-thumbnail" width="200"/>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-lg" (click)="closeUserDetailsModal()">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Edit User Modal -->
<!-- Edit User Modal -->
<div *ngIf="showEditUserModal" class="modal d-block" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit User Info</h5>
        <button type="button" class="close" (click)="closeEditUserModal()">&times;</button>
      </div>
      <div class="modal-body" *ngIf="editUser">
        <form #editUserForm="ngForm">
          <!-- Row 1 -->
          <div class="form-row">
            <div class="form-group col-md-4">
              <label>Full Name</label>
              <input type="text" class="form-control" [(ngModel)]="editUser.fullName" name="fullName">
            </div>
            <div class="form-group col-md-4">
              <label>Phone</label>
              <input type="text" class="form-control" [(ngModel)]="editUser.phone" name="phone">
            </div>
            <div class="form-group col-md-4">
              <label>Email</label>
              <input type="email" class="form-control" [(ngModel)]="editUser.email" name="email">
            </div>
          </div>

          <!-- Row 2 -->
          <div class="form-row">
            <div class="form-group col-md-4">
              <label>Address</label>
              <input type="text" class="form-control" [(ngModel)]="editUser.address" name="address">
            </div>
            <div class="form-group col-md-4">
              <label>NID</label>
              <input type="text" class="form-control" [(ngModel)]="editUser.niD" name="niD">
            </div>
            <div class="form-group col-md-4">
              <label>Father</label>
              <input type="text" class="form-control" [(ngModel)]="editUser.father" name="father">
            </div>
          </div>

          <!-- Row 3 -->
          <div class="form-row">
            <div class="form-group col-md-4">
              <label>Mother</label>
              <input type="text" class="form-control" [(ngModel)]="editUser.mother" name="mother">
            </div>
            <div class="form-group col-md-4">
              <label>Degree</label>
              <input type="text" class="form-control" [(ngModel)]="editUser.degree" name="degree">
            </div>
            <div class="form-group col-md-4">
              <label>Field of Study</label>
              <input type="text" class="form-control" [(ngModel)]="editUser.fieldOfStudy" name="fieldOfStudy">
            </div>
          </div>

          <!-- Row 4 -->
          <div class="form-row">
            <div class="form-group col-md-4">
              <label>School Name</label>
              <input type="text" class="form-control" [(ngModel)]="editUser.schoolName" name="schoolName">
            </div>
            <div class="form-group col-md-4">
              <label>Start Date</label>
              <input type="date" class="form-control" [(ngModel)]="editUser.startDate" name="startDate">
            </div>
            <div class="form-group col-md-4">
              <label>End Date</label>
              <input type="date" class="form-control" [(ngModel)]="editUser.endDate" name="endDate">
            </div>
          </div>

          <!-- Row 5 -->
          <div class="form-row">
            <div class="form-group col-md-8">
              <label>Description</label>
              <input type="text" class="form-control" [(ngModel)]="editUser.description" name="description">
            </div>
            <div class="form-group col-md-4">
              <label>Photo (optional)</label>
              <input type="file" class="form-control" (change)="onEditPhotoSelected($event)">
            </div>
          </div>

          <div *ngIf="editPhotoPreview" class="form-row mt-2">
            <div class="col-md-4">
              <img [src]="editPhotoPreview" alt="Preview" class="img-thumbnail" width="150"/>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeEditUserModal()">Close</button>
        <button type="button" class="btn btn-primary" (click)="saveEditUser()">Save Changes</button>
      </div>
    </div>
  </div>
</div>




