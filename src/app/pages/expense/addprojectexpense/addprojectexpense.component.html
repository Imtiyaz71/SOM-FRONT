<div class="container mt-5">

  <!-- Messages -->
  <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
    {{ successMessage }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
    {{ errorMessage }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <!-- Add Expense Form -->
  <div class="card shadow-sm mb-5">
    <div class="card-header bg-primary text-white fw-bold fs-5">
      Add Project Expense
    </div>
    <div class="card-body">
      <form (ngSubmit)="addExpense()">
        <div class="row g-3">

          <!-- Project Select -->
          <div class="col-md-6">
            <label for="projectId" class="form-label">Project</label>
            <select class="form-select" [(ngModel)]="newExpense.projectId" name="projectId" required>
              <option value="0" disabled>Select Project</option>
              <option *ngFor="let p of project" [value]="p.projectId">{{ p.projectName }}</option>
            </select>
          </div>

          <!-- Amount -->
          <div class="col-md-6">
            <label for="amount" class="form-label">Amount</label>
            <input type="number" class="form-control" id="amount" [(ngModel)]="newExpense.amount" name="amount" required>
          </div>

          <!-- Purpose -->
          <div class="col-md-6">
            <label for="purpose" class="form-label">Purpose</label>
            <input type="text" class="form-control" id="purpose" [(ngModel)]="newExpense.purpose" name="purpose" required>
          </div>


          <!-- Month -->
          <div class="col-md-6">
            <label for="eMonth" class="form-label">Month</label>
            <select class="form-select" id="eMonth" [(ngModel)]="newExpense.eMonth" name="eMonth" required>
              <option value="" disabled selected>Select Month</option>
              <option *ngFor="let m of months" [value]="m">{{ m }}</option>
            </select>
          </div>

          <!-- Year -->
          <div class="col-md-6">
            <label for="eYear" class="form-label">Year</label>
            <select class="form-select" id="eYear" [(ngModel)]="newExpense.eYear" name="eYear" required>
              <option value="" disabled selected>Select Year</option>
              <option *ngFor="let y of years" [value]="y">{{ y }}</option>
            </select>
          </div>

          <!-- Date -->
          <div class="col-md-6">
            <label for="eDate" class="form-label">Date</label>
            <input type="date" class="form-control" id="eDate" [(ngModel)]="newExpense.eDate" name="eDate" required>
          </div>

        </div>

        <div class="mt-4 text-end">
          <button type="submit" class="btn btn-success btn-lg shadow-sm">
            <i class="bi bi-plus-circle"></i> Add Expense
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Expense List Table -->
  <div class="card shadow-sm">
    <div class="card-header bg-info text-white fw-bold fs-5">
      Project Expenses
    </div>
    <div class="card-body p-0 table-responsive">
      <div *ngIf="loading" class="text-center p-3 fs-5">Loading...</div>
  <table class="table table-striped table-hover">
  <thead class="table-dark">
    <tr>
      <th>#</th>
      <th>Project</th>
      <th>Purpose</th>
      <th>Amount</th>
      <th>Date</th>
      <th>Month</th>
      <th>Year</th>
      <th>Expense By</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let exp of pagedExpenses; let i = index">
      <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
      <td>{{ exp.projectInfo }}</td>
      <td>{{ exp.purpose }}</td>
      <td>{{ exp.amount | number:'1.0-0' }}</td>
      <td>{{ exp.eDate | date:'mediumDate' }}</td>
      <td>{{ exp.eMonth }}</td>
      <td>{{ exp.eYear }}</td>
      <td>{{ exp.eBy }}</td>
    </tr>
  </tbody>
</table>

<!-- Pagination Buttons -->
<nav *ngIf="totalPages.length > 1">
  <ul class="pagination justify-content-center mt-3">
    <li class="page-item" [class.disabled]="currentPage === 1">
      <a class="page-link" (click)="changePage(currentPage - 1)">Previous</a>
    </li>
    <li class="page-item" *ngFor="let p of totalPages" [class.active]="p === currentPage">
      <a class="page-link" (click)="changePage(p)">{{ p }}</a>
    </li>
    <li class="page-item" [class.disabled]="currentPage === totalPages.length">
      <a class="page-link" (click)="changePage(currentPage + 1)">Next</a>
    </li>
  </ul>
</nav>

      <div *ngIf="!loading && expenses.length === 0" class="p-3 text-center text-muted">
        No expenses found.
      </div>
    </div>
  </div>
</div>
